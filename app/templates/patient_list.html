{% extends "base.html" %}

{% block title %}All Patients - PatientFlow{% endblock %}

{% block content %}
<div class="patient-list-page">
    <div class="page-header">
        <div class="page-header-content">
            <h1>
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                    <circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                    <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                </svg>
                All Patients
            </h1>
            <p class="page-subtitle">Manage and track all patient intakes</p>
        </div>
        <a href="{{ url_for('main.new_intake') }}" class="btn btn-primary">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/>
            </svg>
            New Intake
        </a>
    </div>

    <div class="filters">
        <a href="{{ url_for('main.patient_list') }}" class="filter-btn {% if not current_filter %}active{% endif %}">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/>
                <rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/>
            </svg>
            All
        </a>
        <a href="{{ url_for('main.patient_list', status='pending') }}" class="filter-btn {% if current_filter == 'pending' %}active{% endif %}">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
            </svg>
            Pending
        </a>
        <a href="{{ url_for('main.patient_list', status='in_progress') }}" class="filter-btn {% if current_filter == 'in_progress' %}active{% endif %}">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/>
            </svg>
            In Progress
        </a>
        <a href="{{ url_for('main.patient_list', status='complete') }}" class="filter-btn {% if current_filter == 'complete' %}active{% endif %}">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                <polyline points="22 4 12 14.01 9 11.01"/>
            </svg>
            Complete
        </a>
        <a href="{{ url_for('main.patient_list', status='flagged') }}" class="filter-btn {% if current_filter == 'flagged' %}active{% endif %}">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"/>
                <line x1="4" y1="22" x2="4" y2="15"/>
            </svg>
            Flagged
        </a>
    </div>

    {% if intakes %}
    <div class="patient-table">
        <table>
            <thead>
                <tr>
                    <th>Patient Name</th>
                    <th>Status</th>
                    <th>Progress</th>
                    <th>Started</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for intake in intakes %}
                <tr>
                    <td>
                        <div class="patient-cell">
                            <div class="patient-cell-avatar">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                                    <circle cx="12" cy="7" r="4"/>
                                </svg>
                            </div>
                            <div>
                                <strong>{{ intake.patient.full_name }}</strong>
                                <small>{{ intake.patient.email or intake.patient.phone or 'No contact' }}</small>
                            </div>
                        </div>
                    </td>
                    <td>
                        <span class="badge badge-{{ intake.status }}">
                            {% if intake.status == 'complete' %}
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="20 6 9 17 4 12"/>
                            </svg>
                            {% elif intake.status == 'in_progress' %}
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/>
                            </svg>
                            {% elif intake.status == 'flagged' %}
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"/>
                            </svg>
                            {% else %}
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                            </svg>
                            {% endif %}
                            {{ intake.status | replace('_', ' ') | title }}
                        </span>
                    </td>
                    <td>
                        <div class="progress-cell">
                            <div class="progress-bar small">
                                <div class="progress-fill" style="width: {{ intake.completion_percentage }}%"></div>
                            </div>
                            <small>{{ intake.completion_percentage }}%</small>
                        </div>
                    </td>
                    <td>{{ intake.started_at.strftime('%m/%d/%Y') if intake.started_at else 'N/A' }}</td>
                    <td>
                        <a href="{{ url_for('main.patient_detail', patient_id=intake.patient_id) }}" class="btn btn-small">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                                <circle cx="12" cy="12" r="3"/>
                            </svg>
                            View
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="empty-state">
        <div class="empty-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                <circle cx="9" cy="7" r="4"/>
                <line x1="19" y1="11" x2="19" y2="17"/><line x1="22" y1="14" x2="16" y2="14"/>
            </svg>
        </div>
        <p>No patients found{% if current_filter %} with status "{{ current_filter }}"{% endif %}.</p>
        <div class="empty-actions">
            <a href="{{ url_for('main.new_intake') }}" class="btn btn-primary">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/>
                </svg>
                Start New Intake
            </a>
            {% if current_filter %}
            <a href="{{ url_for('main.patient_list') }}" class="btn btn-secondary">View All Patients</a>
            {% endif %}
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}
