{% extends "base.html" %}

{% block title %}All Patients - Patient Intake System{% endblock %}

{% block content %}
<div class="patient-list-page">
    <div class="page-header">
        <h1>All Patients</h1>
        <a href="{{ url_for('main.new_intake') }}" class="btn btn-primary">New Intake</a>
    </div>

    <div class="filters">
        <a href="{{ url_for('main.patient_list') }}" class="filter-btn {% if not current_filter %}active{% endif %}">All</a>
        <a href="{{ url_for('main.patient_list', status='pending') }}" class="filter-btn {% if current_filter == 'pending' %}active{% endif %}">Pending</a>
        <a href="{{ url_for('main.patient_list', status='in_progress') }}" class="filter-btn {% if current_filter == 'in_progress' %}active{% endif %}">In Progress</a>
        <a href="{{ url_for('main.patient_list', status='complete') }}" class="filter-btn {% if current_filter == 'complete' %}active{% endif %}">Complete</a>
        <a href="{{ url_for('main.patient_list', status='flagged') }}" class="filter-btn {% if current_filter == 'flagged' %}active{% endif %}">Flagged</a>
    </div>

    {% if intakes %}
    <div class="patient-table">
        <table>
            <thead>
                <tr>
                    <th>Patient Name</th>
                    <th>Status</th>
                    <th>Progress</th>
                    <th>Started</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for intake in intakes %}
                <tr>
                    <td>
                        <strong>{{ intake.patient.full_name }}</strong>
                        <br><small>{{ intake.patient.email or intake.patient.phone or 'No contact' }}</small>
                    </td>
                    <td><span class="badge badge-{{ intake.status }}">{{ intake.status | replace('_', ' ') | title }}</span></td>
                    <td>
                        <div class="progress-bar small">
                            <div class="progress-fill" style="width: {{ intake.completion_percentage }}%"></div>
                        </div>
                        <small>{{ intake.completion_percentage }}%</small>
                    </td>
                    <td>{{ intake.started_at.strftime('%m/%d/%Y') if intake.started_at else 'N/A' }}</td>
                    <td><a href="{{ url_for('main.patient_detail', patient_id=intake.patient_id) }}" class="btn btn-small">View</a></td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <p class="empty-state">No patients found. <a href="{{ url_for('main.new_intake') }}">Start a new intake</a>.</p>
    {% endif %}
</div>
{% endblock %}
